<!DOCTYPE html>
<html lang="en">
<head>

<!--Meta Tags & Codes -->
<!--- General Meta -->
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<!-- For Modern Browsers -->
<link rel="icon" href="https://www.discoverablemarketing.com/favicon.svg" type="image/svg+xml">

<!-- For older browsers -->
<link rel="icon" sizes="16x16 32x32" type="image/x-icon" href="https://www.discoverablemarketing.com/favicon.ico">

<!-- For Android & Chrome fallback -->
<link rel="icon" type="image/png" sizes="192x192" href="https://www.discoverablemarketing.com/favicon-192x192.png">

<!-- For iOS Touch Screens-->
<link rel="apple-touch-icon" sizes="180x180" type="image/png" href="https://www.discoverablemarketing.com/apple-touch-icon.png">

<!-- For Windows Start Screen -->
<meta name="msapplication-TileImage" type="image/png" sizes="144x144" content="https://www.discoverablemarketing.com//mstile-144x144.png">
<meta name="msapplication-TileColor" content="#FFAD6A">


<title>Local Development and Validation of Nuget Packages</title>


<link rel="canonical" href="https://www.discoverablemarketing.com/blog/local-development-and-testing-of-nuget-packages/"/>
<link rel="alternate" href="https://www.discoverablemarketing.com/blog/local-development-and-testing-of-nuget-packages/" hreflang="x-default" />
<meta property="og:url" content="https://www.discoverablemarketing.com/blog/local-development-and-testing-of-nuget-packages/"/>


<meta name="description" content=" Get months of marketing research for just one hour of work. Discoverable helps overworked SaaS marketers outsource manual go-to-market research and find ways to be more discoverable."/>
<meta name="google-site-verification" content="7i-yehDH_LgDCUWUgUwo-ZhCY_Zf7SAQ-_wGwEUeySU"/> 
<link rel="alternate" href="https://www.discoverablemarketing.com/blog-feed.xml" type="application/rss+xml" title="Discoverable - RSS"/> 

<!--- OpenGraph -->
<meta property="og:title" content="Local Development and Validation of Nuget Packages"/>
<meta property="og:description" content=""/>
<meta property="og:image" content="https://www.discoverablemarketing.com/assets/images/important/cover.jpg"/>
<meta property="og:image:width" content="1200"/>
<meta property="og:image:height" content="628"/>
<meta property="og:site_name" content="Discoverable Marketing"/>

<meta property="og:type" content="website"/> 


<!--- Robots -->
<meta name="robots" content="max-image-preview:large"/>


<!--- Schemas -->

<script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","name":"Discoverable Marketing","legalName":"Discoverable Marketing","url":"https://www.discoverablemarketing.com/","@id":"discoverablemarketing.com/#organization","logo":"https://www.discoverablemarketing.com/assets/images/important/DiscoverableLogo_Color_240.png","foundingDate":"2022","founders":[{"@type":"Person","name":"Chris Shuptrine"}],"contactPoint":{"@type":"ContactPoint","contactType":"customer support","email":"chris@discoverablemarketing.com","url":"https://www.discoverablemarketing.com/contact/"}}</script>
<script type="application/ld+json">{"@context":"https://schema.org","@type":"LocalBusiness","name":"Discoverable Marketing","image":"https://www.discoverablemarketing.com/assets/images/important/DiscoverableLogo_Color_240.png","url":"https://www.discoverablemarketing.com/","@id":"discoverablemarketing.com/#organization","telephone":"910-516-8273","openingHoursSpecification":{"@type":"OpeningHoursSpecification","dayOfWeek":["Monday","Tuesday","Wednesday","Thursday","Friday"],"opens":"09:00","closes":"17:30"}}</script>

  

  

  




<script>
  window.dataLayer = window.dataLayer || [];

  function loadGTM() {
    (function(w, d, s, l, i) {
      w[l] = w[l] || [];
      w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
      var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
      j.async = true;
      j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
      f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-587TTM6');
  }

  function lazyLoadGTM() {
    window.removeEventListener('scroll', lazyLoadGTM);
    loadGTM();
  }

  window.addEventListener('scroll', lazyLoadGTM);
</script>

<!-- Start of HubSpot Embed Code -->
<script type="text/javascript" id="hs-script-loader">
    // Function to load the script
    function loadHubSpotScript() {
        var script = document.createElement('script');
        script.src = "//js.hs-scripts.com/24298198.js";
        document.body.appendChild(script);
    }

    // Add scroll event listener
    window.addEventListener('scroll', function() {
        var loadPosition = 500; // Change this value based on when you want to load the script
        if (window.scrollY > loadPosition) {
            loadHubSpotScript();
            // Remove the event listener after the script is loaded
            window.removeEventListener('scroll', arguments.callee);
        }
    });
</script>
<!-- End of HubSpot Embed Code -->

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var image = document.querySelector('.hero-image');

        // Define the breakpoint for mobile devices (e.g., 768px for tablets)
        var mobileBreakpoint = 768;

        // Check if the screen width is less than or equal to the breakpoint
        if (window.innerWidth <= mobileBreakpoint) {
            // It's a mobile device, so add the lazy loading attribute
            image.setAttribute('loading', 'lazy');
        }
    });
</script>

<style>
.post-title {
  font-family: Arial, sans-serif !important;
}

.post-font2 {
  font-family: Arial, sans-serif !important;
}

.post-font p {
  font-family: Arial, sans-serif !important;
  font-size: 17px; /* Adjust this value to your desired font size */
  font-weight: 400; /* Adjust this value for desired font weight, e.g., 400 (normal), 500 (medium), 600 (semi-bold), etc. */
  line-height: 1.5; /* Adjust this value for desired space between rows; higher values increase space */
  }

.strong, b {
  font-weight: bold !important;
}

.hero2 {
  width: 100%;
  background-color: #3877f6 !important; /* Your desired color */
  padding-top: 5%;
}

.hero-contents2 {
    padding-left: 10%;
    padding-right: 10%;
}

</style>

<!--SCSS -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--Toggled -->

  
</head>

<body >
  
<nav
  class="navbar  absolute nav-uppercase  navbar-hover-opacity navbar-expand-lg">
  <div
    class=" container  flex-row justify-content-center">
    <div class="navbar-brand">
      <a href="/">

        
        <img src="/assets/images/important/nyckel-logo-320x48.png"
         class=" logo-dark  "
          alt="Discoverable logo" width="320" height="77"/>

        <!--
        
        <img src="/assets/images/important/nyckel-black-small.png"
          srcset="/assets/images/important/nyckel-black-small.png 1x, /assets/images/important/nyckel-black.png 2x"
          class=" logo-dark  "
          alt="Nyckel" width="180" height="27"/> -->

      </a>
    </div>
    <div class="navbar-other ml-auto order-lg-3">
      <ul class="navbar-nav flex-row align-items-center" data-sm-skip="true">
        <li class="nav-item">
          <div class="navbar-hamburger d-lg-none d-xl-none ml-auto"><button class="hamburger animate plain" data-toggle="offcanvas-nav"><span></span></button></div>
        </li>
        <li class="nav-item d-none d-lg-block pl-0" style="padding-right:2%"><a href="/contact/" class="btn m-0" style="background-color:#3877f6;">Contact</a></li>
       <li class="nav-item d-none d-lg-block pl-0"><a href="/contact-report/" class="btn m-0" style="background-color:#E96A57">Free Sign-Up</a></li>
      </ul>
      <!-- /.navbar-nav -->
    </div>
    <!-- /.navbar-other -->

    <div class="navbar-collapse offcanvas-nav">
      <div class="offcanvas-header d-lg-none d-xl-none">
        <a href="/">
          <img src="/assets/images/important/DiscoverableLogo_White_320.webp" class="logo-light" alt="Discoverable logo" width="180" height="27" loading="lazy"/></a>
        <button class="plain offcanvas-close offcanvas-nav-close"><i class="jam jam-close"></i></button>
      </div>
      <ul class="navbar-nav mx-auto">
        
        
        
        <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="/pricing/">Pricing</a>
        </li>
        
        
        
        
        <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="https://www.nyckel.com/customers/">Customers</a>
        </li>
        
        
        
        
        <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="/about/">About</a>
        </li>
        
        
        
        
        <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="/blog/">Blog</a>
        </li>
        
        
        
        
        <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="https://www.nyckel.com/docs">API Docs</a>
        </li>
        
        
      </ul>
      <!-- /.navbar-nav -->
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>

<!--<div class="post-font2 post-font">-->
<div class="content-wrapper">
<div class="wrapper white-wrapper">
    <div class="row">
    </div></div>
        <div id="main" role="main" class="readingpane">
<article class="post">

  
  <div class="hero hero2">
    <div class="hero-contents hero-contents2 contain-1200 p-mobile-1350 d-flex">
      <div class="title-area d-flex flex-column justify-content-between">
        <div>
          <h1 style="font-size: 0.6em;">Local Development and Validation of Nuget Packages</h1>
          <div class="summary">Learnings from setting up a local development workflow for developing and validating nuget packages</div>
        </div>

        
        
        <div class="author">
          <div class="author-area">
            
            <img src="https://avatars.githubusercontent.com/saintarian" alt="mugshot" class="author-icon" />
            
            <span class="author-name">George Mathew</span>
            
            <a href="https://github.com/saintarian" target="_blank">
              <i class="fa fa-github fa-lg social-icon"></i>
            </a>
            
            
            <a href="https://twitter.com/georgemkan" target="_blank">
              <i class="fa fa-twitter fa-lg social-icon"></i>
            </a>
            
            
            
            <a href="https://linkedin.com/in/georgemathew" target="_blank">
              <i class="fa fa-linkedin fa-lg social-icon"></i>
            </a>
            
            
          </div>
          <span class="date">
            Posted Oct 2021
          </span>
        </div>
        
      </div>
      
    </div>
  </div>

  <div class="entry">
    <p><em>Why is an ML company talking about nuget instead of PyTorch or transformers? Because we are C# nerds and because production ML is a <a href="https://www.nyckel.com/blog/ml-too-hard-for-software-developers/">whole lot more</a> than training a model. You shouldn’t need to know anything about PyTorch, tensors, or GPUs to use ML. More on that in this <a href="https://www.youtube.com/watch?v=BzawKd_7WDY">short video</a>.</em></p>

<hr />

<p>At Nyckel, we use C# extensively for critical parts of our stack. We publish a set of internal .NET libraries that
are then used by our tools and services. Since nuget is the preferred .NET package manager, we publish and
consume these libraries as nuget packages hosted on a private nuget repo on
<a href="https://aws.amazon.com/codeartifact/">AWS CodeArtifact</a>.</p>

<h2 id="motivation">Motivation</h2>

<p>We insist on having a local development workflow for our stack. This is for two reason:</p>

<ul>
  <li>We want to detect problems with code changes as early as possible.</li>
  <li>We want to keep our change –&gt; verify –&gt; fix cycle time as short as possible.</li>
</ul>

<p>Naturally, we wanted a local development experience for verifying changes to our nuget libraries against their
consumers. Setting this up took a surprising amount of research and effort. This post attempts to save you the
same effort by showing you where we ended up.</p>

<h2 id="setup">Setup</h2>

<p>For the rest of the post, let’s assume we have the following:</p>

<ul>
  <li>A <code class="language-plaintext highlighter-rouge">Nyckel.Common</code> C# library that doesn’t depend on any other library we author.</li>
  <li>A <code class="language-plaintext highlighter-rouge">Nyckel.Http</code> C# library that depends on <code class="language-plaintext highlighter-rouge">Nyckel.Common</code>.</li>
  <li>Both libraries live in the same github repository called <code class="language-plaintext highlighter-rouge">dotnet-libraries</code>. The repository has a <code class="language-plaintext highlighter-rouge">.sln</code> solution file
that contains both projects.</li>
  <li>A CI/CD setup that automatically publishes the libraries on each commit to <code class="language-plaintext highlighter-rouge">main</code>. The libraries are published to AWS CodeArtifact and versioned as <code class="language-plaintext highlighter-rouge">1.0.&lt;ci-build-number&gt;</code>.</li>
  <li>A <code class="language-plaintext highlighter-rouge">Nyckel.Server</code> C# service in a separate github repository called <code class="language-plaintext highlighter-rouge">server</code>. It depends on a recent
<code class="language-plaintext highlighter-rouge">1.0.&lt;ci-build-number&gt;</code> version of <code class="language-plaintext highlighter-rouge">Nyckel.Http</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">dotnet</code> cli and <a href="https://dotnet.microsoft.com/en-us/download/dotnet/5.0">SDK 5.0</a> installed on the local development
machine. Instructions below have only been tested on Mac and Linux, but I don’t foresee any problems following along on
Windows.</li>
</ul>

<h2 id="local-development-requirements">Local Development Requirements</h2>

<p>We wanted the following the following local-development workflows to work in the above <a href="#setup">setup</a>:</p>

<ol>
  <li>Make a local, uncommitted breaking change to <code class="language-plaintext highlighter-rouge">Nyckel.Common</code> that affects <code class="language-plaintext highlighter-rouge">Nyckel.Http</code>. Detect the breaking change
when building the <code class="language-plaintext highlighter-rouge">dotnet-libraries</code> repo. Make the corresponding change to <code class="language-plaintext highlighter-rouge">Nyckel.Http</code> and verify that it fixes the
build locally.</li>
  <li>Make enhancements to <code class="language-plaintext highlighter-rouge">Nyckel.Http</code>. Test <code class="language-plaintext highlighter-rouge">Nyckel.Server</code> locally using the enhanced <code class="language-plaintext highlighter-rouge">Nyckel.Http</code> before we
commit those changes. We want to do this even though we have comprehensive unit-tests for our libraries.</li>
  <li>Achieve the above two with minimal cycle time and cognitive overhead. Existing local development workflows should
require minimal modifications.</li>
</ol>

<h2 id="solution">Solution</h2>

<p>The solution requires setting up project dependencies for inter-library dependencies, and a local nuget repository for
quick testing of library-consumer dependencies. Below I walk through those, build and package steps, and some gotchas
like nuget package caching.</p>

<h3 id="project-dependencies">Project Dependencies</h3>

<p><code class="language-plaintext highlighter-rouge">Nyckel.Http.csproj</code> has the following lines it it:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ItemGroup&gt;</span>
  <span class="nt">&lt;ProjectReference</span> <span class="na">Include=</span><span class="s">"..\Common\Nyckel.Common.csproj"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre></div></div>

<p>You’ll notice that there’s nothing special here - it’s just the usual project reference from <code class="language-plaintext highlighter-rouge">Nyckel.Http</code> to
<code class="language-plaintext highlighter-rouge">Nyckel.Common</code> (remember that they are in the same git repository, so the relative path reference works). We were
initially worried that it would result in <code class="language-plaintext highlighter-rouge">Nyckel.Common.dll</code> being copied over instead of creating a nuget reference.
But, as we shall see when we <a href="#testing-the-workflows">test it out</a>, it actually does the right thing.</p>

<p>This also ensures that <code class="language-plaintext highlighter-rouge">Nyckel.Common</code> is always built before <code class="language-plaintext highlighter-rouge">Nyckel.Http</code>. This fulfills requirement #1 above -
a breaking change to <code class="language-plaintext highlighter-rouge">Nyckel.Common</code> will be detected when building the <code class="language-plaintext highlighter-rouge">dotnet-libraries</code> repo. We can make the
corresponding change to <code class="language-plaintext highlighter-rouge">Nyckel.Http</code> and re-build to verify that it works.</p>

<h3 id="local-nuget-source">Local Nuget Source</h3>

<p>For requirement #2, to minimize cycle time, we set up a local nuget repository. Run the following:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet nuget add <span class="nb">source</span> ~/nuget <span class="nt">--name</span> <span class="nb">local</span>
</code></pre></div></div>

<p>This sets up a local nuget repository at <code class="language-plaintext highlighter-rouge">~/nuget</code> and names it <code class="language-plaintext highlighter-rouge">local</code>. We will soon be pushing to it when building
locally.</p>

<h3 id="local-nuget-package-version-and-nuget-caching">Local Nuget Package Version and Nuget Caching</h3>

<p>CI systems usually have a monotonically increasing build number that you can use to version your nuget packages and
publish them as immutable artifacts. We currently use a version number of the form <code class="language-plaintext highlighter-rouge">1.0.&lt;build-number&gt;</code>. For local
builds, however, we don’t care about immutability and want to avoid the cognitive overhead of incrementing some version
number when publishing <em>and</em> consuming. Instead, we always use the version <code class="language-plaintext highlighter-rouge">1.0.0-local</code>.</p>

<p>This presents a challenge - nuget caches recently used packages so that they don’t have to be
fetched from their (usually remote) repositories each time. Unfortunately, the cache is used even for locally
published packages. Given this, and given our fixed <code class="language-plaintext highlighter-rouge">1.0.0-local</code> version number, we could end up in a situation
where <code class="language-plaintext highlighter-rouge">Nyckel.Server</code> is using an older cached version of <code class="language-plaintext highlighter-rouge">Nyckel.Http</code>. To get around this, we add a step to the
library <code class="language-plaintext highlighter-rouge">.csproj</code> files that clears the local cache before creating a new nuget package. Let’s look at this next.</p>

<h3 id="csproj-file-additions">Csproj File Additions</h3>

<p>In the <code class="language-plaintext highlighter-rouge">dotnet-libraries</code> repo, we have a <code class="language-plaintext highlighter-rouge">Nuget.targets</code> file that contains the following:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Project&gt;</span>
  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;IsPackable&gt;</span>true<span class="nt">&lt;/IsPackable&gt;</span>
    <span class="nt">&lt;NYCKEL_NUGET_VERSION</span> <span class="na">Condition=</span><span class="s">"'$(NYCKEL_NUGET_VERSION)' == ''"</span><span class="nt">&gt;</span>1.0.0-local<span class="nt">&lt;/NYCKEL_NUGET_VERSION&gt;</span>
    <span class="nt">&lt;PackageVersion&gt;</span>$(NYCKEL_NUGET_VERSION)<span class="nt">&lt;/PackageVersion&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

  <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"DeleteLocalCache"</span> <span class="na">BeforeTargets=</span><span class="s">"Pack"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;RemoveDir</span> <span class="na">Directories=</span><span class="s">"$(NugetPackageRoot)/$(PackageId.ToLower())/1.0.0-local"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Target&gt;</span>
<span class="nt">&lt;/Project&gt;</span>
</code></pre></div></div>

<p>This does a few things:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">IsPackable</code> indicates that the project is a type (library) that can be packaged into a nuget package. See
<a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-pack">dotnet pack</a>.</li>
  <li>A <code class="language-plaintext highlighter-rouge">NYCKEL_NUGET_VERSION</code> environment variable is used as the nuget package version. It is set by the
<a href="#ci-package-and-publish">CI build script</a>. If it’s not set, we assume that this is a local build and default to
<code class="language-plaintext highlighter-rouge">1.0.0-local</code>.</li>
  <li>The <code class="language-plaintext highlighter-rouge">DeleteLocalCache</code> target runs before the <code class="language-plaintext highlighter-rouge">Pack</code> step (which creates a nuget package) and deletes the cache
for this package.</li>
</ul>

<p>In each of our library <code class="language-plaintext highlighter-rouge">.csproj</code> files (like <code class="language-plaintext highlighter-rouge">Nyckel.Common.csproj</code> and <code class="language-plaintext highlighter-rouge">Nyckel.Proxy.csproj</code>), we add the following
snippet to include the above file:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Import</span> <span class="na">Project=</span><span class="s">"../Nuget.targets"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<h3 id="local-build">Local Build</h3>

<p>To build libraries locally, we run the following from the root of the <code class="language-plaintext highlighter-rouge">dotnet-libraries</code> project:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet build
</code></pre></div></div>

<p>Nothing fancy - just the normal build command. It works because we have a <code class="language-plaintext highlighter-rouge">.sln</code> solution file in the repo root,
and because the project dependencies (and build order) are encoded in <code class="language-plaintext highlighter-rouge">.csproj</code> files. We followed instructions
<a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-sln">here</a> to use the <code class="language-plaintext highlighter-rouge">dotnet sln</code> command to create a solution file and add projects to it.</p>

<h3 id="local-package-and-publish">Local Package and Publish</h3>

<p>To create nuget packages and publish to the local nuget repository, we run the following:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Creates nuget packages (in .nupkg files) in ./nupkgs</span>
dotnet pack <span class="nt">-o</span> nupkgs
<span class="c"># Publishes all nuget packages in ./nupkgs to the local nuget repository</span>
dotnet nuget push <span class="s1">'nupkgs/*.nupkg'</span> <span class="nt">--source</span> <span class="nb">local</span>
</code></pre></div></div>

<p>We can then modify <code class="language-plaintext highlighter-rouge">Nyckel.Server.csproj</code> to use version <code class="language-plaintext highlighter-rouge">1.0.0-local</code> of <code class="language-plaintext highlighter-rouge">Nyckel.Http</code>, test locally, then
commit changes to <code class="language-plaintext highlighter-rouge">dotnet-libraries</code>. We then change <code class="language-plaintext highlighter-rouge">Nyckel.Server.csproj</code> back to using a non-local version of
<code class="language-plaintext highlighter-rouge">Nyckel.Http</code>. If we forget to do this for some reason, the error will be caught as a build failure in the CI system.</p>

<h3 id="ci-package-and-publish">CI Package and Publish</h3>

<p>On our CI system we set up <code class="language-plaintext highlighter-rouge">AWS CodeArtifact</code> as a nuget repo named <code class="language-plaintext highlighter-rouge">nyckel/libraries</code>. We run the following from
the root of the <code class="language-plaintext highlighter-rouge">dotnet-libraries</code> project:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">NYCKEL_NUGET_VERSION</span><span class="o">=</span>1.0.<span class="nv">$CI_BUILD_NUMBER</span>
dotnet pack <span class="nt">-c</span> Release <span class="nt">-o</span> nupkgs
dotnet nuget push <span class="s1">'nupkgs/*.nupkg'</span> <span class="nt">--source</span> nyckel/libraries
</code></pre></div></div>

<p>When we want <code class="language-plaintext highlighter-rouge">Nyckel.Server</code> to use the latest version of <code class="language-plaintext highlighter-rouge">Nyckel.Http</code>, we update the version in
<code class="language-plaintext highlighter-rouge">Nyckel.Server.csproj</code> to <code class="language-plaintext highlighter-rouge">1.0.$CI_BUILD_NUMBER</code> for the latest CI build of the <code class="language-plaintext highlighter-rouge">dotnet-libraries</code> repo.</p>

<h2 id="testing-the-workflows">Testing the Workflows</h2>

<p>To make sure that it all works as expected, we ran the following steps:</p>

<ol>
  <li>Make a change in <code class="language-plaintext highlighter-rouge">Nyckel.Common</code> that breaks <code class="language-plaintext highlighter-rouge">Nyckel.Http</code>.</li>
  <li>Run <a href="#local-build">local build</a>. Verify that the build breaks.</li>
  <li>Fix the build in <code class="language-plaintext highlighter-rouge">Nyckel.Http</code>.</li>
  <li>Re-run <a href="#local-build">local build</a>. Verify that the build passes.</li>
  <li>Run <a href="#local-package-and-publish">local package and publish</a>.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">Nuget Package Explorer</code> (<a href="https://nuget.info/packages">Web App</a> or <a href="https://apps.microsoft.com/store/detail/nuget-package-explorer/9WZDNCRDMDM3?hl=en-us&amp;gl=us">Windows App</a>) to open up <code class="language-plaintext highlighter-rouge">dotnet-libraries/nupkgs/Nyckel.Http.1.0.0-local.nupkg</code>. This <code class="language-plaintext highlighter-rouge">.nupkg</code>
file would have been created in the previous local package step. Go to the <code class="language-plaintext highlighter-rouge">Dependencies</code> tab and make sure there is
a dependency on <code class="language-plaintext highlighter-rouge">Nyckel.Common</code>. Expand the folders in the <code class="language-plaintext highlighter-rouge">Contents</code> tab and make sure <code class="language-plaintext highlighter-rouge">Nyckel.Common.dll</code> is not
included.</li>
  <li>Change <code class="language-plaintext highlighter-rouge">Nyckel.Server.csproj</code> locally to use version <code class="language-plaintext highlighter-rouge">1.0.0-local</code> of <code class="language-plaintext highlighter-rouge">Nyckel.Http</code>. Run <code class="language-plaintext highlighter-rouge">Nyckel.Server</code> locally.
This will ensure that the nuget cache is populated.</li>
  <li>Make a change in <code class="language-plaintext highlighter-rouge">Nyckel.Http</code> that breaks <code class="language-plaintext highlighter-rouge">Nyckel.Server</code>.</li>
  <li>Re-run <a href="#local-package-and-publish">local package and publish</a>.</li>
  <li>Re-run <code class="language-plaintext highlighter-rouge">Nyckel.Server</code>. Verify that the build breaks.</li>
</ol>

<h2 id="conclusion">Conclusion</h2>

<p>As you can see, getting everything to work is not trivial, even without all the research and trial-and-error it took
to get here. Despite the level of effort, we are happy with our setup. If you have similar requirements, I hope you
find this write-up helpful.</p>


  </div>

</article></div></div></div>
</div><!--</div>-->

<!--likely needed for hero banner loads -->
  <script defer src="/assets/js/jquery.min.js"></script>
  <script defer src="/assets/js/popper.min.js"></script>
  <script defer src="/assets/js/bootstrap.min.js"></script>
  <script defer src="/assets/revolution/js/jquery.themepunch.tools.min.js"></script>
  <script defer src="/assets/revolution/js/jquery.themepunch.revolution.min.js"></script>

  <!--likely not needed for hero banner loads -->
  <script defer src="/assets/revolution/js/extensions/revolution.extension.actions.min.js"></script>
  <script defer src="/assets/revolution/js/extensions/revolution.extension.carousel.min.js"></script>
  <script defer src="/assets/revolution/js/extensions/revolution.extension.kenburn.min.js"></script>
  <script defer src="/assets/revolution/js/extensions/revolution.extension.layeranimation.min.js"></script>
  <script defer src="/assets/revolution/js/extensions/revolution.extension.migration.min.js"></script>
  <script defer src="/assets/revolution/js/extensions/revolution.extension.navigation.min.js"></script>
  <script defer src="/assets/revolution/js/extensions/revolution.extension.parallax.min.js"></script>
  <script defer src="/assets/revolution/js/extensions/revolution.extension.slideanims.min.js"></script>
  <script defer src="/assets/revolution/js/extensions/revolution.extension.video.min.js"></script>
  <script defer src="/assets/js/plugins.js"></script>
 <script defer src="/assets/js/simple-jekyll-search.min.js"></script>
  <script defer src="/assets/js/scripts.js"></script>
               <div style="margin-top:-10%"><div class="wrapper image-wrapper light-wrapper bg-auto no-overlay bg-image text-center" data-image-src="/assets/images/important/map.webp">
                <div class="container inner">
                    <div class="row">
                        <div class="col-md-9 mx-auto">
                             <h3 class="display-3">Subscribe for more ML content</h3>

     <p class="lead larger" style="padding-left:15%;padding-right:15%">
                            We send occasional email newsletters with informative content about how to solve problems with machine learning, product updates, and more. Subscribe to get updates sent directly to your inbox.</p>
                            <div class="space20"></div>

                            
                             <div style="padding-left:28%;padding-right:25%"> <button data-tf-popup="WRFhNxwm" data-tf-iframe-props="title=Newsletter Signup" data-tf-medium="snippet"
        data-tf-size="70">
        Sign me up
    </button>
    <script src="//embed.typeform.com/next/embed.js"></script></div></div>

                  
                        </div>
                    </div>
                </div>
            </div></div>



  <footer class="image-wrapper bg-image page-title-wrapper inverse-text" data-image-src="/assets/images/important/home-bg.webp" loading="lazy">
  <div class="divider"><svg xmlns="http://www.w3.org/2000/svg" class="fill-light-wrapper position-absolute" preserveAspectRatio="none" viewBox="0 0 1070 52">
 <path d="M0,0S247,91,505,32c261.17-59.72,565-13,565-13V0Z" /></svg></div>

 

  <div class="space50"></div>
  <div class="container inner pt-80 pb-50 text-center">
    <div class="row">
      <div class="col-md-10 offset-md-1">
        <div class="row">
          <div class="col-md-4">


<div class="widget">
          
           <div class="h5 widget-title" style="color: white;">Learn More</div>
          
          <ul class="list-unstyled mb-0">
            <li><a href="/contact/">Contact</a></li>
             <li><a href="/pricing/">Pricing</a></li>
                   <li><a href="/pricing/">Pre-Trained Functions</a></li>
          </ul>

        </div>


          </div>
          <!-- /column -->
          <div class="col-md-4">
            <div class="widget">
              <div class="h3 widget-title" style="color: white;">Follow Us</div>
              <ul class="social social-mute social-s">
                
               <li><a href="https://github.com/nyckelai" title="Nyckel on Github"><i class="jam jam-github"></i></a></li>
                
               <li><a href="https://www.youtube.com/@nyckelai" title="Nyckel on YouTube"><i class="jam jam-youtube"></i></a></li>
                
               <li><a href="https://www.linkedin.com/company/discoverable-marketing/" title="Discoverable Marketing on LinkedIn"><i class="jam jam-linkedin"></i></a></li>
                
              </ul>
            </div>
            <!-- /.widget -->
          </div>
          <!-- /column -->
          <div class="col-md-4">
            
        <div class="widget">
          
           <div class="h5 widget-title" style="color: white;">Company</div>
          
          <ul class="list-unstyled mb-0">
            
            <li><a href="/about/">About</a></li>
            
            <li><a href="/blog/">Blog</a></li>
            
            <li><a href="https://www.nyckel.com/customers/">Customers</a></li>
            
          </ul>
        </div>
        <!-- /.widget -->
          </div>
          <!-- /column -->
        </div>
        <!-- /.row -->
      </div>
      <!-- /column -->
    </div>
    <div class="space30"></div>
    <p class="text-center">© 2023 Nyckel | <a href="/privacy-policy/">Privacy Policy</a> | <a href="/terms-and-conditions/">T&Cs</a></p>
  </div>
</footer>
  
</body>
</html>