<!DOCTYPE html>
<html lang="en">

<head>
{% include /tags/meta.html %}
{% include /tags/head.html %}

<!--SCSS -->
<link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">

</head>

<body {% if page.overflow %} class="overflow-hidden" {% endif %}>
{% if page.url contains '/blog/' or page.url contains '/pretrained-models/' %}
{% include header.html container_class="container" extra_class="absolute nav-uppercase" %}
{% else %}
{% if page.nav == 'light' %}
{% include header.html container_class="container" extra_class="absolute transparent inverse-text nav-uppercase"
light_logo="true" %}
{% else %}
{% include header.html container_class="container" extra_class="absolute nav-uppercase" %}
{% endif %}
{% endif %}

<div class="content-wrapper main-content">
{{ content }}
</div>

{% if page.url contains '/blog/' %}
{% include /cta/cta-blog.html %}
{% elsif page.url contains '/pretrained-models/' %}
{% include /cta/cta-functions.html %}
{% elsif page.cta2 %}
{% else %}
{% include /cta/cta.html %}
{% endif %}

{% include footer.html light_logo="true" %}
{% include /tags/body.html %}

<!-- Above-the-fold JS tags -->
<script src="{{relative_url}}/assets/js/jquery.min.js"></script>
<script src="{{relative_url}}/assets/js/popper.min.js"></script>
<script src="{{relative_url}}/assets/js/bootstrap.min.js"></script>
<script src="{{relative_url}}/assets/revolution/js/jquery.revolution.min.js"></script>
<script src="{{relative_url}}/assets/js/plugins.js"></script>
<script src="{{relative_url}}/assets/js/scripts.js"></script>
<!-- End Above-the-fold JS tags -->

<!-- Lazyloaded JavaScript Tags -->
<script>
    var jsUrls = [
        "{{relative_url}}/assets/revolution/js/extensions/revolution.extension.actions.min.js",
        "{{relative_url}}/assets/revolution/js/extensions/revolution.extension.carousel.min.js",
        "{{relative_url}}/assets/revolution/js/extensions/revolution.extension.kenburn.min.js",
        "{{relative_url}}/assets/revolution/js/extensions/revolution.extension.layeranimation.min.js",
        "{{relative_url}}/assets/revolution/js/extensions/revolution.extension.migration.min.js",
        "{{relative_url}}/assets/revolution/js/extensions/revolution.extension.navigation.min.js",
        "{{relative_url}}/assets/revolution/js/extensions/revolution.extension.parallax.min.js",
        "{{relative_url}}/assets/revolution/js/extensions/revolution.extension.slideanims.min.js",
        "{{relative_url}}/assets/revolution/js/extensions/revolution.extension.video.min.js",
        "{{relative_url}}/assets/js/simple-jekyll-search.min.js",
        "/assets/js/codebox.js",
        "{{relative_url}}/assets/js/plugins.js",
        "{{relative_url}}/assets/revolution/js/jquery.tools.min.js",
        "/assets/js/lite-yt.js",
        "/assets/js/invoke.js"
    ];

    var hasLoadedJsFiles = new Array(jsUrls.length).fill(false);

    window.onscroll = function() {
        for (var i = 0; i < jsUrls.length; i++) {
            if (!hasLoadedJsFiles[i]) {
                var script = document.createElement('script');
                script.src = jsUrls[i];
                script.type = 'text/javascript';
                document.body.appendChild(script);

                // Remember that we've loaded this JavaScript file so we don't try to load it again
                hasLoadedJsFiles[i] = true;
            }
        }
    };
</script>
<!-- End Lazyloaded JavaScript Tags -->

<!-- Lazyloaded CSS -->
<script>
    function loadCSS(urls) {
        urls.forEach(function(url) {
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = url;
            link.onerror = function() {
                console.error('Failed to load CSS:', url);
            };
            document.head.appendChild(link);
        });
    }

    var cssLoaded = false;

    function handleScroll() {
        if (!cssLoaded && window.scrollY > 100) { // Check if scrolled more than 100 pixels
            loadCSS([
                '/assets/css/lazy/style-lazy.css',
                '/assets/css/lazy/layers.css',
                '/assets/css/lazy/plugins-lazy.css',
                '/assets/css/lazy/type-lazy.css',
                // Add more URLs as needed
            ]);
            cssLoaded = true;
            window.removeEventListener('scroll', handleScroll); // Remove event listener once CSS is loaded
        }
    }

    window.addEventListener('scroll', handleScroll, { passive: true });
</script>
<!-- End Lazyloaded CSS -->

<!--<script>
$(function () {
    // preventing page from redirecting
    $("html").on("dragover", function (e) {
        e.preventDefault();
        e.stopPropagation();
        $("h2").text("Drag here");
    });

    $("html").on("drop", function (e) {
        e.preventDefault();
        e.stopPropagation();
    });

    $(".upload-area").on("dragenter", function (e) {
        e.stopPropagation();
        e.preventDefault();
        $("h2").text("Drop");
    });

    $(".upload-area").on("dragover", function (e) {
        e.stopPropagation();
        e.preventDefault();
        $("h2").text("Drop");
    });

    $(".upload-area").on("drop", function (e) {
        e.stopPropagation();
        e.preventDefault();
        $("h2").text("Checking...");

        var file = e.originalEvent.dataTransfer.files[0];
        invokeImage(file);
    });

    // Open file selector on div click
    $("#uploadfile").click(function () {
        $("#file").click();
    });

    // On file selected
    $("#file").change(function () {
        var file = $("#file")[0].files[0];
        if (!file) return;

        invokeImage(file);
    });
});

function invokeImage(file) {
    $(".upload-instructions").hide();
    resetPage();
    $("#thinking").show();

    showImage(file);
    resizeAndUploadImage(file);
}

function showImage(file) {
    var reader = new FileReader();
    reader.onload = function (e) {
        $(".upload-area").css("background-image", "url(" + e.target.result + ")");
    };
    reader.readAsDataURL(file);
}

function resizeAndUploadImage(file) {
    // Ensure it's an image
    if (file.type.match(/image.*/)) {
        // Load the image
        var reader = new FileReader();
        reader.onload = function (readerEvent) {
            var image = new Image();
            image.onload = function (imageEvent) {
                // Resize the image
                var canvas = document.createElement("canvas"),
                    max_size = 600,
                    width = image.width,
                    height = image.height;
                if (width > height) {
                    if (width > max_size) {
                        height *= max_size / width;
                        width = max_size;
                    }
                } else {
                    if (height > max_size) {
                        width *= max_size / height;
                        height = max_size;
                    }
                }
                canvas.width = width;
                canvas.height = height;
                canvas.getContext("2d").drawImage(image, 0, 0, width, height);
                var dataUrl = canvas.toDataURL("image/jpeg");
                var resizedImage = dataURLToBlob(dataUrl);

                checkImageWithNyckel(resizedImage);
            };
            image.src = readerEvent.target.result;
        };
        reader.readAsDataURL(file);
    } else {
        alert("You must choose an image");
        resetPage();
    }
}

var dataURLToBlob = function (dataUrl) {
    var BASE64_MARKER = ";base64,";
    if (dataUrl.indexOf(BASE64_MARKER) == -1) {
        var parts = dataUrl.split(",");
        var contentType = parts[0].split(":")[1];
        var raw = parts[1];

        return new Blob([raw], { type: contentType });
    }

    var parts = dataUrl.split(BASE64_MARKER);
    var contentType = parts[0].split(":")[1];
    var raw = window.atob(parts[1]);
    var rawLength = raw.length;

    var uInt8Array = new Uint8Array(rawLength);

    for (var i = 0; i < rawLength; ++i) {
        uInt8Array[i] = raw.charCodeAt(i);
    }

    return new Blob([uInt8Array], { type: contentType });
};

function displayResult(response) {
    var confidence = response.confidence.toLocaleString(undefined, { style: 'percent', minimumFractionDigits: 2 });
    resetPage();
    $("#prediction #label-name").text(response.labelName);
    $("#prediction #confidence").text(confidence + " confident");
    $("#prediction").show();
}

function displayError(response) {
    resetPage();
    $("#error #message").text("There was an error trying to call Nyckel");
    $("#error").show();
    console.log(response);
}

function resetPage() {
    $("#error").hide();
    $("#thinking").hide();
    $("#prediction").hide();
    $("#no-prediction").hide();
}

// Sending AJAX request to Nyckel to run against ML model
function checkImageWithNyckel(image) {
    var formdata = new FormData();
    formdata.append("file", image);

    var functionId = $("#invoke-container").data("functionId");
    var url = `https://www.nyckel.com/v1/functions/${functionId}/invoke`;

    $.ajax({
        url: url,
        type: "post",
        data: formdata,
        contentType: false,
        processData: false,
        dataType: "json",
        success: function (response) {
            displayResult(response);
        },
        error: function (response) {
            displayError(response);
        }
    });
}
</script>-->


</body>
</html>