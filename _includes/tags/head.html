<!-- Google Analytics - This script loads the analytics library asynchronously -->

<!--<script async src="https://www.googletagmanager.com/gtag/js?id=UA-191564533-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());

  const gaMeasurementID = 'UA-191564533-1';
  gtag('config', gaMeasurementID, {
    'linker': {'domains': ['www.nyckel.com', 'login.nyckel.com', 'try.nyckel.com']}
  });

  // Function to trigger a page view for SPA or after navigation
  window.pageChange = (path) => {
    gtag('config', gaMeasurementID, { 'page_path': path });
  };
</script> -->

<script>
  window.dataLayer = window.dataLayer || [];

  function loadGTM() {
    (function(w, d, s, l, i) {
      w[l] = w[l] || [];
      w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
      var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
      j.async = true;
      j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
      f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-WXH98NF7');
  }

  function lazyLoadGTM() {
    window.removeEventListener('scroll', lazyLoadGTM);
    loadGTM();
  }

  window.addEventListener('scroll', lazyLoadGTM);
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var image = document.querySelector('.hero-image');

        // Define the breakpoint for mobile devices (e.g., 768px for tablets)
        var mobileBreakpoint = 768;

        // Check if the screen width is less than or equal to the breakpoint
        if (window.innerWidth <= mobileBreakpoint) {
            // It's a mobile device, so add the lazy loading attribute
            image.setAttribute('loading', 'lazy');
        }
    });
</script>

{% if page.hubspot %}
<!-- Start of HubSpot Embed Code -->
<script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/24298198.js"></script>
<!-- End of HubSpot Embed Code -->
{% endif %}

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var iframe = document.querySelector('iframe[data-src]');
    var iframeLoaded = false;

    function loadIframe() {
        var rect = iframe.getBoundingClientRect();
        var windowHeight = (window.innerHeight || document.documentElement.clientHeight);
        var windowWidth = (window.innerWidth || document.documentElement.clientWidth);

        // Check if iframe is in the viewport
        if (rect.top <= windowHeight && rect.left <= windowWidth && rect.bottom >= 0 && rect.right >= 0) {
            // Set the src attribute to the actual URL
            iframe.src = iframe.getAttribute('data-src');
            iframeLoaded = true;

            // Remove the event listener once the iframe has loaded
            window.removeEventListener('scroll', loadIframe);
        }
    }

    // Attach scroll event listener
    window.addEventListener('scroll', loadIframe);

    // Load iframe if it's already in the viewport without scrolling
    loadIframe();
});
</script>


